# cbindgen configuration for hcore_ffi
# See: https://github.com/mozilla/cbindgen/blob/master/docs.md

language = "C"
cpp_compat = true
include_version = true
autogen_warning = "/* AUTO-GENERATED by cbindgen - DO NOT EDIT */"

# Documentation style
documentation = true
documentation_style = "doxy"
documentation_length = "full"

# Header content with hardening macros
header = """/**
 * @file hcore.h
 * @brief HyprCore FFI Interface - C bindings for the HyprCore library
 * 
 * Provides a stable C-ABI interface for configuration management,
 * logging, packaging, and fragment processing.
 * 
 * @see https://github.com/ryugen/hyprcore
 */

#ifndef HCORE_H
#define HCORE_H

/* Compiler feature detection and hardening macros */
#if defined(__GNUC__) || defined(__clang__)
  #define HCORE_API __attribute__((visibility("default")))
  #define HCORE_WARN_UNUSED_RESULT __attribute__((warn_unused_result))
  #define HCORE_NONNULL(...) __attribute__((nonnull(__VA_ARGS__)))
  #define HCORE_DEPRECATED(msg) __attribute__((deprecated(msg)))
  #define HCORE_PRINTF(fmt, args) __attribute__((format(printf, fmt, args)))
#elif defined(_MSC_VER)
  #define HCORE_API __declspec(dllexport)
  #define HCORE_WARN_UNUSED_RESULT _Check_return_
  #define HCORE_NONNULL(...)
  #define HCORE_DEPRECATED(msg) __declspec(deprecated(msg))
  #define HCORE_PRINTF(fmt, args)
#else
  #define HCORE_API
  #define HCORE_WARN_UNUSED_RESULT
  #define HCORE_NONNULL(...)
  #define HCORE_DEPRECATED(msg)
  #define HCORE_PRINTF(fmt, args)
#endif

/* Thread safety annotations (Clang only) */
#if defined(__clang__) && defined(__has_attribute)
  #if __has_attribute(capability)
    #define HCORE_CAPABILITY(x) __attribute__((capability(x)))
    #define HCORE_REQUIRES(...) __attribute__((requires_capability(__VA_ARGS__)))
    #define HCORE_EXCLUDES(...) __attribute__((locks_excluded(__VA_ARGS__)))
  #endif
#endif
#ifndef HCORE_CAPABILITY
  #define HCORE_CAPABILITY(x)
  #define HCORE_REQUIRES(...)
  #define HCORE_EXCLUDES(...)
#endif

/* Null pointer check helper */
#define HCORE_ASSERT_NOT_NULL(ptr) \\
    do { if (!(ptr)) { return; } } while(0)
#define HCORE_ASSERT_NOT_NULL_RET(ptr, ret) \\
    do { if (!(ptr)) { return (ret); } } while(0)"""

trailer = """
/* ABI version for runtime compatibility checks */
#define HCORE_ABI_VERSION_MAJOR 0
#define HCORE_ABI_VERSION_MINOR 2
#define HCORE_ABI_VERSION_PATCH 1

/* End of hcore.h */"""

# Formatting
line_length = 100
tab_width = 4
style = "both"

# Pointer configuration
[ptr]
# Use const for input parameters
non_null_attribute = "HCORE_NONNULL"

[defines]
# Define platform-specific macros if needed

[export]
include = []
exclude = []
prefix = ""
item_types = ["constants", "globals", "enums", "structs", "unions", "typedefs", "opaque", "functions"]
# Add prefix for exported functions
rename = {}

[enum]
rename_variants = "None"
add_sentinel = false
prefix_with_name = false

[struct]
rename_fields = "None"
derive_constructor = false
derive_eq = false
derive_neq = false
derive_lt = false
derive_lte = false
derive_gt = false
derive_gte = false

[fn]
rename_args = "None"
args = "auto"
sort_by = "None"
# Mark functions returning pointers/ints that should be checked
must_use = "HCORE_WARN_UNUSED_RESULT"

[parse]
parse_deps = false
clean = false

# After options - add attributes after function declarations
[export.body]
# Add HCORE_API to exported functions
